# Story 1.1: User and Tenant Registration

## Status
Approved

## Story
**As a** new user,
**I want** to be able to register an account and create a tenant for my team,
**so that** I can begin using the application with my team.

## Acceptance Criteria
1. User can register with username and password
2. During registration, user creates a tenant with a name
3. User is automatically associated with the created tenant
4. Registration validates unique usernames
5. Password requirements are enforced
6. Both user and tenant data are persisted to database

## Tasks / Subtasks
- [ ] Task 0: Environment configuration setup (Pre-implementation)
  - [ ] Configure Next.js dev server to use port 3060 (update package.json scripts)
  - [ ] Check available PostgreSQL ports and configure database connection
  - [ ] Set up PostgreSQL database named `flowseo_dev`
  - [ ] Configure .env.local with database URL and port settings
- [ ] Task 1: Set up database schema for users and tenants (AC: 1, 2, 3, 6)
  - [ ] Create Prisma schema for User and Tenant models
  - [ ] Configure database relationships between User and Tenant
  - [ ] Run database migrations
- [ ] Task 2: Create registration API endpoint (AC: 1, 2, 4, 5, 6)
  - [ ] Implement POST /api/v1/tenants endpoint for tenant creation
  - [ ] Implement user registration logic with tenant association
  - [ ] Add username uniqueness validation
  - [ ] Add password validation and hashing
  - [ ] Add proper error handling and responses
- [ ] Task 3: Create registration UI components (AC: 1, 2, 5)
  - [ ] Create registration form component with username/password fields
  - [ ] Add tenant name field to registration form
  - [ ] Implement form validation on frontend
  - [ ] Add proper error display and user feedback
- [ ] Task 4: Testing (All ACs)
  - [ ] Write unit tests for registration API endpoint
  - [ ] Write E2E tests for registration flow using Playwright
  - [ ] Test validation edge cases

## Dev Notes

**Project Setup Context:**
This is a new Next.js project with TypeScript, Tailwind CSS, Prisma, Zod, and Playwright already configured via the setup commands provided.

**Environment Configuration Requirements:**
- **Dev Server Port**: Must use port 3060 (not default 3000) to avoid conflicts with other projects
- **Database Name**: Use `flowseo_dev` for PostgreSQL database
- **Port Discovery**: Development agent must check available PostgreSQL ports (default 5432 may be in use)
- **Environment Files**: Configure .env.local with proper DATABASE_URL and NEXTAUTH_URL settings

**Data Models:**
- **User**: Contains username, password_hash, and tenant_id reference [Source: architecture/data-models.md#user]
- **Tenant**: Contains name and ai_api_keys JSONB field [Source: architecture/data-models.md#tenant]

**Database Schema:**
```sql
CREATE TABLE tenants (
    id UUID PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    ai_api_keys JSONB
);

CREATE TABLE users (
    id UUID PRIMARY KEY,
    username VARCHAR(255) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    tenant_id UUID REFERENCES tenants(id)
);
```
[Source: architecture/database-schema.md]

**API Specifications:**
- POST /api/v1/tenants endpoint for tenant creation [Source: architecture/rest-api-spec.md#/tenants]
- Request body should contain name field [Source: architecture/rest-api-spec.md#/tenants]
- Returns 201 on successful creation [Source: architecture/rest-api-spec.md#/tenants]

**Tech Stack Requirements:**
- Use TypeScript for all development [Source: architecture/tech-stack.md]
- Use Zod for data validation on frontend and backend [Source: architecture/tech-stack.md]
- Use Prisma for database ORM [Source: architecture/tech-stack.md]
- Use Tailwind CSS for styling [Source: architecture/tech-stack.md]
- Use Playwright for E2E testing [Source: architecture/tech-stack.md]

**File Locations:**
Current project structure is standard Next.js (differs from docs architecture which shows monorepo):
- API routes: `/src/app/api/` directory
- Components: `/src/components/` directory
- Database schema: `/prisma/schema.prisma`
- E2E tests: `/tests/` or `/e2e/` directory

**Project Structure Notes:**
The current project uses standard Next.js structure, not the monorepo structure shown in architecture docs. File locations should follow Next.js conventions.

### Testing
**Testing Standards from Architecture:**
- Use Playwright for end-to-end testing [Source: architecture/tech-stack.md]
- All tests must pass for story completion [Source: architecture/coding-standards.md]
- No specific testing strategy file found in architecture docs

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-19 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2025-09-19 | 1.1 | Added environment configuration requirements (port 3060, flowseo_dev database) | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here*